<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | RustMe Client</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="logo-icon">ü¶Ä</span>
                <span class="logo-text">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/account/" class="nav-link">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                <a href="/admin/" class="nav-link active">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
            </div>
            <button class="btn-login" id="logoutBtn">–í—ã–π—Ç–∏</button>
        </div>
    </nav>

    <div class="admin-container">
        <div class="admin-sidebar">
            <div class="admin-user" id="adminUserInfo">
                <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
            <nav class="admin-nav">
                <a href="#" class="admin-nav-link active" data-section="keys">
                    <i class="fas fa-key"></i> –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–π
                </a>
                <a href="#" class="admin-nav-link" data-section="users">
                    <i class="fas fa-users"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </a>
                <a href="#" class="admin-nav-link" data-section="stats">
                    <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </a>
                <a href="#" class="admin-nav-link" data-section="settings">
                    <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </a>
            </nav>
        </div>

        <div class="admin-content">
            <!-- –°–µ–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∫–ª—é—á–µ–π -->
            <section class="admin-section active" id="keysSection">
                <h2>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–π</h2>
                <div class="generator-card">
                    <div class="form-group">
                        <label>–¢–∏–ø –∫–ª—é—á–∞</label>
                        <select id="keyType" class="form-select">
                            <option value="basic">Basic ($99)</option>
                            <option value="full">Full ($199)</option>
                            <option value="legit">Legit ($79)</option>
                            <option value="lite">Lite ($89)</option>
                            <option value="tester">Tester (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
                        <select id="keyDuration" class="form-select">
                            <option value="day">1 –¥–µ–Ω—å</option>
                            <option value="3days">3 –¥–Ω—è</option>
                            <option value="week">1 –Ω–µ–¥–µ–ª—è</option>
                            <option value="month">1 –º–µ—Å—è—Ü</option>
                            <option value="forever">–ù–∞–≤—Å–µ–≥–¥–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π</label>
                        <input type="number" id="keyCount" min="1" max="100" value="1" class="form-input">
                    </div>
                    <button class="btn-primary" id="generateKeysBtn">
                        <i class="fas fa-magic"></i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏
                    </button>
                </div>

                <div class="generated-keys" id="generatedKeys">
                    <!-- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <section class="admin-section" id="usersSection">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                <div class="users-table-container">
                    <table class="users-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                                <th>–†–æ–ª—å</th>
                                <th>–ü–æ–¥–ø–∏—Å–∫–∞</th>
                                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <section class="admin-section" id="statsSection">
                <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-value" id="totalRevenue">$0</div>
                        <div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîë</div>
                        <div class="stat-value" id="activeKeys">0</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–ª—é—á–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="todayUsers">0</div>
                        <div class="stat-label">–ù–æ–≤—ã–µ —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
            <section class="admin-section" id="settingsSection">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                <div class="settings-card">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞</label>
                        <input type="text" id="siteName" value="RustMe Client" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Telegram –ø–æ–¥–¥–µ—Ä–∂–∫–∏</label>
                        <input type="text" id="telegramSupport" value="@dadepbabki" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>–¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞</label>
                        <select id="themeColor" class="form-select">
                            <option value="blue">–°–∏–Ω—è—è</option>
                            <option value="purple">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è</option>
                            <option value="green">–ó–µ–ª–µ–Ω–∞—è</option>
                            <option value="red">–ö—Ä–∞—Å–Ω–∞—è</option>
                        </select>
                    </div>
                    <button class="btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script src="/script.js"></script>
    <script>
        class AdminPanel {
            constructor() {
                this.currentUser = JSON.parse(localStorage.getItem('rustme_current_user') || 'null');
                if (!this.currentUser || this.currentUser.role !== 'Developer') {
                    window.location.href = '/';
                    return;
                }
                this.init();
            }

            init() {
                this.renderUserInfo();
                this.loadUsers();
                this.loadStats();
                this.bindEvents();
            }

            renderUserInfo() {
                document.getElementById('adminUserInfo').innerHTML = `
                    <div class="admin-user-card">
                        <div class="admin-user-avatar">üëë</div>
                        <div class="admin-user-details">
                            <div class="admin-user-name">${this.currentUser.username}</div>
                            <div class="admin-user-role">Developer</div>
                        </div>
                    </div>
                `;
            }

            loadUsers() {
                const users = JSON.parse(localStorage.getItem('rustme_users') || '[]');
                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = '';

                users.forEach(user => {
                    const tr = document.createElement('tr');
                    
                    const roles = {
                        'Developer': 'üëë Developer',
                        '–ù–∞–¥–∑–∏—Ä–∞—Ç–µ–ª—å–Æ–¢': 'üî± –ù–∞–¥–∑–∏—Ä–∞—Ç–µ–ª—å–Æ–¢',
                        'Alpha': '‚ö° Alpha',
                        'Moder': 'üõ°Ô∏è Moder',
                        'Full': 'üíé Full',
                        'Legit': 'üé≠ Legit',
                        'Basic': 'üîì Basic',
                        'Lite': '‚ö° Lite',
                        'Tester': 'üß™ Tester',
                        '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å': 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
                    };

                    tr.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${roles[user.role] || user.role}</td>
                        <td>${user.subscription || '–ù–µ—Ç'}</td>
                        <td>${new Date(user.createdAt).toLocaleDateString('ru-RU')}</td>
                        <td>
                            <button class="btn-action edit-user" data-id="${user.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${user.role !== 'Developer' ? `
                                <button class="btn-action delete-user" data-id="${user.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                document.querySelectorAll('.edit-user').forEach(btn => {
                    btn.addEventListener('click', (e) => this.editUser(e.target.closest('button').dataset.id));
                });

                document.querySelectorAll('.delete-user').forEach(btn => {
                    btn.addEventListener('click', (e) => this.deleteUser(e.target.closest('button').dataset.id));
                });
            }

            loadStats() {
                const users = JSON.parse(localStorage.getItem('rustme_users') || '[]');
                
                // –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                document.getElementById('totalUsers').textContent = users.length;
                
                // –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–ª—é—á–∏
                const activeKeys = users.filter(u => u.key).length;
                document.getElementById('activeKeys').textContent = activeKeys;
                
                // –ù–æ–≤—ã–µ —Å–µ–≥–æ–¥–Ω—è
                const today = new Date().toDateString();
                const todayUsers = users.filter(u => 
                    new Date(u.createdAt).toDateString() === today
                ).length;
                document.getElementById('todayUsers').textContent = todayUsers;
                
                // –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
                const revenue = users.reduce((sum, user) => {
                    const prices = {
                        'basic': 99, 'full': 199, 'legit': 79, 'lite': 89
                    };
                    return sum + (prices[user.subscription?.toLowerCase()] || 0);
                }, 0);
                document.getElementById('totalRevenue').textContent = `$${revenue}`;
            }

            generateKey() {
                const type = document.getElementById('keyType').value;
                const duration = document.getElementById('keyDuration').value;
                const count = parseInt(document.getElementById('keyCount').value);
                
                const keys = [];
                const types = {
                    'basic': 'RUSTME-BASIC',
                    'full': 'RUSTME-FULL',
                    'legit': 'RUSTME-LEGIT',
                    'lite': 'RUSTME-LITE',
                    'tester': 'RUSTME-TESTER'
                };
                
                const durations = {
                    'day': '1D',
                    '3days': '3D',
                    'week': '1W',
                    'month': '1M',
                    'forever': 'FOREVER'
                };
                
                for (let i = 0; i < count; i++) {
                    const random = Math.random().toString(36).substring(2, 10).toUpperCase();
                    const key = `${types[type]}-${durations[duration]}-${random}-${Date.now().toString(36).toUpperCase()}`;
                    keys.push(key);
                }
                
                this.displayKeys(keys);
            }

            displayKeys(keys) {
                const container = document.getElementById('generatedKeys');
                container.innerHTML = '<h3>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏:</h3>';
                
                keys.forEach(key => {
                    const keyElement = document.createElement('div');
                    keyElement.className = 'key-item';
                    keyElement.innerHTML = `
                        <code>${key}</code>
                        <button class="btn-copy" data-key="${key}">
                            <i class="fas fa-copy"></i>
                        </button>
                    `;
                    container.appendChild(keyElement);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                document.querySelectorAll('.btn-copy').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const key = e.target.closest('button').dataset.key;
                        navigator.clipboard.writeText(key);
                        alert('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                    });
                });
            }

            editUser(userId) {
                const users = JSON.parse(localStorage.getItem('rustme_users') || '[]');
                const user = users.find(u => u.id == userId);
                
                if (user) {
                    const newRole = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é —Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user.role);
                    if (newRole && newRole !== user.role) {
                        user.role = newRole;
                        localStorage.setItem('rustme_users', JSON.stringify(users));
                        this.loadUsers();
                        alert('–†–æ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                    }
                }
            }

            deleteUser(userId) {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                    let users = JSON.parse(localStorage.getItem('rustme_users') || '[]');
                    users = users.filter(u => u.id != userId);
                    localStorage.setItem('rustme_users', JSON.stringify(users));
                    this.loadUsers();
                    this.loadStats();
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω!');
                }
            }

            bindEvents() {
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                document.querySelectorAll('.admin-nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = link.dataset.section;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                        document.querySelectorAll('.admin-nav-link').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        
                        document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
                        document.getElementById(`${section}Section`).classList.add('active');
                    });
                });

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
                document.getElementById('generateKeysBtn').addEventListener('click', () => {
                    this.generateKey();
                });

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                document.getElementById('saveSettingsBtn').addEventListener('click', () => {
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                });

                // –í—ã—Ö–æ–¥
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    localStorage.removeItem('rustme_current_user');
                    window.location.href = '/';
                });
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            new AdminPanel();
        });
    </script>

    <style>
        .admin-container {
            display: flex;
            min-height: calc(100vh - 80px);
            margin-top: 80px;
        }

        .admin-sidebar {
            width: 250px;
            background: rgba(15, 23, 42, 0.95);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 1rem;
        }

        .admin-user-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            margin-bottom: 2rem;
        }

        .admin-user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .admin-user-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .admin-user-role {
            font-size: 0.875rem;
            color: #FFD700;
            font-weight: 500;
        }

        .admin-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .admin-nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            color: var(--gray);
            text-decoration: none;
            border-radius: 0.75rem;
            transition: all 0.3s ease;
        }

        .admin-nav-link:hover,
        .admin-nav-link.active {
            background: var(--gradient-primary);
            color: white;
        }

        .admin-nav-link i {
            width: 20px;
            text-align: center;
        }

        .admin-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .admin-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .admin-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .generator-card,
        .settings-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 500px;
            margin-top: 1.5rem;
        }

        .form-select,
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            color: var(--light);
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        .form-select:focus,
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .generated-keys {
            margin-top: 2rem;
        }

        .key-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .key-item code {
            font-family: monospace;
            font-size: 0.875rem;
            word-break: break-all;
        }

        .btn-copy {
            background: var(--gradient-primary);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-left: 1rem;
        }

        .users-table-container {
            overflow-x: auto;
            margin-top: 1.5rem;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .users-table th,
        .users-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .users-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }

        .users-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-action {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--light);
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-right: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn-action:hover {
            background: var(--gradient-primary);
            border-color: var(--primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: var(--gradient-card);
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.875rem;
        }
    </style>
</body>
</html>